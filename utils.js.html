<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>utils.js - Documentation</title>

    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="https://code.ionicframework.com/ionicons/2.0.1/css/ionicons.min.css">
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav>
    <li class="nav-link nav-home-link"><a href="index.html">Home</a></li><li class="nav-heading">Classes</li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AccountCallBuilder.html">AccountCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#accountId">accountId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#forAsset">forAsset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#forLiquidityPool">forLiquidityPool</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#forSigner">forSigner</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#sponsor">sponsor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AccountRequiresMemoError.html">AccountRequiresMemoError</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AccountResponse.html">AccountResponse</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountResponse.html#accountId">accountId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountResponse.html#incrementSequenceNumber">incrementSequenceNumber</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AccountResponse.html#sequenceNumber">sequenceNumber</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="AssetsCallBuilder.html">AssetsCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#forCode">forCode</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#forIssuer">forIssuer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="AssetsCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="CallBuilder.html">CallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="CallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html">ClaimableBalanceCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#asset">asset</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#claimableBalance">claimableBalance</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#claimant">claimant</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#sponsor">sponsor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="ClaimableBalanceCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Config.html">Config</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Config.html#.getTimeout">getTimeout</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Config.html#.isAllowHttp">isAllowHttp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Config.html#.setAllowHttp">setAllowHttp</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Config.html#.setDefault">setDefault</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Config.html#.setTimeout">setTimeout</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="EffectCallBuilder.html">EffectCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#forAccount">forAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#forLedger">forLedger</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#forLiquidityPool">forLiquidityPool</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#forOperation">forOperation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#forTransaction">forTransaction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="EffectCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="FederationServer.html">FederationServer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FederationServer.html#.createForDomain">createForDomain</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FederationServer.html#.resolve">resolve</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FederationServer.html#resolveAccountId">resolveAccountId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FederationServer.html#resolveAddress">resolveAddress</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="FederationServer.html#resolveTransactionId">resolveTransactionId</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="LedgerCallBuilder.html">LedgerCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LedgerCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LedgerCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LedgerCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LedgerCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LedgerCallBuilder.html#ledger">ledger</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LedgerCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LedgerCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LedgerCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html">LiquidityPoolCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#forAccount">forAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#forAssets">forAssets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#liquidityPoolId">liquidityPoolId</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="LiquidityPoolCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="OfferCallBuilder.html">OfferCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#buying">buying</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#forAccount">forAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#offer">offer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#selling">selling</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#sponsor">sponsor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OfferCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="OperationCallBuilder.html">OperationCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#forAccount">forAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#forClaimableBalance">forClaimableBalance</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#forLedger">forLedger</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#forLiquidityPool">forLiquidityPool</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#forTransaction">forTransaction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#includeFailed">includeFailed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#operation">operation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="OperationCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="OrderbookCallBuilder.html">OrderbookCallBuilder</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PathCallBuilder.html">PathCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PathCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PathCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PathCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PathCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PathCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PathCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PathCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="PaymentCallBuilder.html">PaymentCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#forAccount">forAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#forLedger">forLedger</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#forTransaction">forTransaction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="PaymentCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="Server.html">Server</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#accounts">accounts</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#assets">assets</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#checkMemoRequired">checkMemoRequired</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#claimableBalances">claimableBalances</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#effects">effects</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#feeStats">feeStats</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#fetchBaseFee">fetchBaseFee</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#fetchTimebounds">fetchTimebounds</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#ledgers">ledgers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#liquidityPools">liquidityPools</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#loadAccount">loadAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#offers">offers</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#operations">operations</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#orderbook">orderbook</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#payments">payments</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#strictReceivePaths">strictReceivePaths</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#strictSendPaths">strictSendPaths</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#submitTransaction">submitTransaction</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#tradeAggregation">tradeAggregation</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#trades">trades</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Server.html#transactions">transactions</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="StellarTomlResolver.html">StellarTomlResolver</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StellarTomlResolver.html#.resolve">resolve</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="StrictReceivePathCallBuilder.html">StrictReceivePathCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictReceivePathCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictReceivePathCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictReceivePathCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictReceivePathCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictReceivePathCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictReceivePathCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictReceivePathCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="StrictSendPathCallBuilder.html">StrictSendPathCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictSendPathCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictSendPathCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictSendPathCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictSendPathCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictSendPathCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictSendPathCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="StrictSendPathCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TradeAggregationCallBuilder.html">TradeAggregationCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradeAggregationCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradeAggregationCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradeAggregationCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradeAggregationCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradeAggregationCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradeAggregationCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradeAggregationCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TradesCallBuilder.html">TradesCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#forAccount">forAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#forAssetPair">forAssetPair</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#forLiquidityPool">forLiquidityPool</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#forOffer">forOffer</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#forType">forType</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TradesCallBuilder.html#stream">stream</a></span></li><li class="nav-heading"><span class="nav-item-type type-class">C</span><span class="nav-item-name"><a href="TransactionCallBuilder.html">TransactionCallBuilder</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#call">call</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#cursor">cursor</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#forAccount">forAccount</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#forClaimableBalance">forClaimableBalance</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#forEndpoint">forEndpoint</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#forLedger">forLedger</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#forLiquidityPool">forLiquidityPool</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#includeFailed">includeFailed</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#join">join</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#limit">limit</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#order">order</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#stream">stream</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="TransactionCallBuilder.html#transaction">transaction</a></span></li><li class="nav-heading">Namespaces</li><li class="nav-heading"><span class="nav-item-type type-namespace">N</span><span class="nav-item-name"><a href="Utils.html">Utils</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.buildChallengeTx">buildChallengeTx</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.gatherTxSigners">gatherTxSigners</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.readChallengeTx">readChallengeTx</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.validateTimebounds">validateTimebounds</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.verifyChallengeTxSigners">verifyChallengeTxSigners</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.verifyChallengeTxThreshold">verifyChallengeTxThreshold</a></span></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="Utils.html#.verifyTxSignedBy">verifyTxSignedBy</a></span></li><li class="nav-heading"><a href="global.html">Globals</a></li><li class="nav-item"><span class="nav-item-type type-function">F</span><span class="nav-item-name"><a href="global.html#getCurrentServerTime">getCurrentServerTime</a></span></li><li class="nav-item"><span class="nav-item-type type-member">M</span><span class="nav-item-name"><a href="global.html#SERVER_TIME_MAP">SERVER_TIME_MAP</a></span></li>
</nav>

<div id="main">
    
    <h1 class="page-title">utils.js</h1>
    

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>import clone from "lodash/clone";
import randomBytes from "randombytes";
import { Account, BASE_FEE, FeeBumpTransaction, Keypair, Memo, MemoID, MemoNone, Operation, TimeoutInfinite, Transaction, TransactionBuilder, } from "stellar-base";
import { InvalidSep10ChallengeError } from "./errors";
/**
 * @namespace Utils
 */
export var Utils;
(function (Utils) {
    /**
     * Returns a valid [SEP0010](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md)
     * challenge transaction which you can use for Stellar Web Authentication.
     *
     * @see [SEP0010: Stellar Web Authentication](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md).
     * @function
     * @memberof Utils
     * @param {Keypair} serverKeypair Keypair for server's signing account.
     * @param {string} clientAccountID The stellar account (G...) or muxed account (M...) that the wallet wishes to authenticate with the server.
     * @param {string} homeDomain The fully qualified domain name of the service requiring authentication
     * @param {number} [timeout=300] Challenge duration (default to 5 minutes).
     * @param {string} networkPassphrase The network passphrase. If you pass this argument then timeout is required.
     * @param {string} webAuthDomain The fully qualified domain name of the service issuing the challenge.
     * @param {string} [memo] The memo to attach to the challenge transaction. The memo must be of type `id`. If the `clientaccountID` is a muxed account, memos cannot be used.
     * @param {string} [clientDomain] The fully qualified domain of the client requesting the challenge. Only necessary when the the 'client_domain' parameter is passed.
     * @param {string} [clientSigningKey] The public key assigned to the SIGNING_KEY attribute specified on the stellar.toml hosted on the client domain. Only necessary when the 'client_domain' parameter is passed.
     * @example
     * import { Utils, Keypair, Networks }  from 'stellar-sdk'
     *
     * let serverKeyPair = Keypair.fromSecret("server-secret")
     * let challenge = Utils.buildChallengeTx(serverKeyPair, "client-stellar-account-id", "stellar.org", 300, Networks.TESTNET)
     * @returns {string} A base64 encoded string of the raw TransactionEnvelope xdr struct for the transaction.
     */
    function buildChallengeTx(serverKeypair, clientAccountID, homeDomain, timeout = 300, networkPassphrase, webAuthDomain, memo = null, clientDomain = null, clientSigningKey = null) {
        if (clientAccountID.startsWith("M") &amp;&amp; memo) {
            throw Error("memo cannot be used if clientAccountID is a muxed account");
        }
        const account = new Account(serverKeypair.publicKey(), "-1");
        const now = Math.floor(Date.now() / 1000);
        // A Base64 digit represents 6 bits, to generate a random 64 bytes
        // base64 string, we need 48 random bytes = (64 * 6)/8
        //
        // Each Base64 digit is in ASCII and each ASCII characters when
        // turned into binary represents 8 bits = 1 bytes.
        const value = randomBytes(48).toString("base64");
        const builder = new TransactionBuilder(account, {
            fee: BASE_FEE,
            networkPassphrase,
            timebounds: {
                minTime: now,
                maxTime: now + timeout,
            },
        })
            .addOperation(Operation.manageData({
            name: `${homeDomain} auth`,
            value,
            source: clientAccountID,
        }))
            .addOperation(Operation.manageData({
            name: "web_auth_domain",
            value: webAuthDomain,
            source: account.accountId(),
        }));
        if (clientDomain) {
            if (!clientSigningKey) {
                throw Error("clientSigningKey is required if clientDomain is provided");
            }
            builder.addOperation(Operation.manageData({
                name: `client_domain`,
                value: clientDomain,
                source: clientSigningKey,
            }));
        }
        if (memo) {
            builder.addMemo(Memo.id(memo));
        }
        const transaction = builder.build();
        transaction.sign(serverKeypair);
        return transaction
            .toEnvelope()
            .toXDR("base64")
            .toString();
    }
    Utils.buildChallengeTx = buildChallengeTx;
    /**
     * readChallengeTx reads a SEP 10 challenge transaction and returns the decoded
     * transaction and client account ID contained within.
     *
     * It also verifies that the transaction has been signed by the server.
     *
     * It does not verify that the transaction has been signed by the client or
     * that any signatures other than the server's on the transaction are valid. Use
     * one of the following functions to completely verify the transaction:
     * - verifyChallengeTxThreshold
     * - verifyChallengeTxSigners
     *
     * @see [SEP0010: Stellar Web Authentication](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md).
     * @function
     * @memberof Utils
     * @param {string} challengeTx SEP0010 challenge transaction in base64.
     * @param {string} serverAccountID The server's stellar account (public key).
     * @param {string} networkPassphrase The network passphrase, e.g.: 'Test SDF Network ; September 2015'.
     * @param {string|string[]} [homeDomains] The home domain that is expected to be included in the first Manage Data operation's string key. If an array is provided, one of the domain names in the array must match.
     * @param {string} webAuthDomain The home domain that is expected to be included as the value of the Manage Data operation with the 'web_auth_domain' key. If no such operation is included, this parameter is not used.
     * @returns {Transaction|string|string|string} The actual transaction and the stellar public key (master key) used to sign the Manage Data operation, the matched home domain, and the memo attached to the transaction, which will be null if not present.
     */
    function readChallengeTx(challengeTx, serverAccountID, networkPassphrase, homeDomains, webAuthDomain) {
        var _a;
        if (serverAccountID.startsWith("M")) {
            throw Error("Invalid serverAccountID: multiplexed accounts are not supported.");
        }
        let transaction;
        try {
            transaction = new Transaction(challengeTx, networkPassphrase);
        }
        catch (_b) {
            try {
                transaction = new FeeBumpTransaction(challengeTx, networkPassphrase);
            }
            catch (_c) {
                throw new InvalidSep10ChallengeError("Invalid challenge: unable to deserialize challengeTx transaction string");
            }
            throw new InvalidSep10ChallengeError("Invalid challenge: expected a Transaction but received a FeeBumpTransaction");
        }
        // verify sequence number
        const sequence = Number.parseInt(transaction.sequence, 10);
        if (sequence !== 0) {
            throw new InvalidSep10ChallengeError("The transaction sequence number should be zero");
        }
        // verify transaction source
        if (transaction.source !== serverAccountID) {
            throw new InvalidSep10ChallengeError("The transaction source account is not equal to the server's account");
        }
        // verify operation
        if (transaction.operations.length &lt; 1) {
            throw new InvalidSep10ChallengeError("The transaction should contain at least one operation");
        }
        const [operation, ...subsequentOperations] = transaction.operations;
        if (!operation.source) {
            throw new InvalidSep10ChallengeError("The transaction's operation should contain a source account");
        }
        const clientAccountID = operation.source;
        let memo = null;
        if (transaction.memo.type !== MemoNone) {
            if (clientAccountID.startsWith("M")) {
                throw new InvalidSep10ChallengeError("The transaction has a memo but the client account ID is a muxed account");
            }
            if (transaction.memo.type !== MemoID) {
                throw new InvalidSep10ChallengeError("The transaction's memo must be of type `id`");
            }
            memo = transaction.memo.value;
        }
        if (operation.type !== "manageData") {
            throw new InvalidSep10ChallengeError("The transaction's operation type should be 'manageData'");
        }
        // verify timebounds
        if (transaction.timeBounds &amp;&amp;
            Number.parseInt((_a = transaction.timeBounds) === null || _a === void 0 ? void 0 : _a.maxTime, 10) === TimeoutInfinite) {
            throw new InvalidSep10ChallengeError("The transaction requires non-infinite timebounds");
        }
        // give a small grace period for the transaction time to account for clock drift
        if (!validateTimebounds(transaction, 60 * 5)) {
            throw new InvalidSep10ChallengeError("The transaction has expired");
        }
        if (operation.value === undefined) {
            throw new InvalidSep10ChallengeError("The transaction's operation values should not be null");
        }
        // verify base64
        if (!operation.value) {
            throw new InvalidSep10ChallengeError("The transaction's operation value should not be null");
        }
        if (Buffer.from(operation.value.toString(), "base64").length !== 48) {
            throw new InvalidSep10ChallengeError("The transaction's operation value should be a 64 bytes base64 random string");
        }
        // verify homeDomains
        if (!homeDomains) {
            throw new InvalidSep10ChallengeError("Invalid homeDomains: a home domain must be provided for verification");
        }
        let matchedHomeDomain;
        if (typeof homeDomains === "string") {
            if (`${homeDomains} auth` === operation.name) {
                matchedHomeDomain = homeDomains;
            }
        }
        else if (Array.isArray(homeDomains)) {
            matchedHomeDomain = homeDomains.find((domain) => `${domain} auth` === operation.name);
        }
        else {
            throw new InvalidSep10ChallengeError(`Invalid homeDomains: homeDomains type is ${typeof homeDomains} but should be a string or an array`);
        }
        if (!matchedHomeDomain) {
            throw new InvalidSep10ChallengeError("Invalid homeDomains: the transaction's operation key name does not match the expected home domain");
        }
        // verify any subsequent operations are manage data ops and source account is the server
        for (const op of subsequentOperations) {
            if (op.type !== "manageData") {
                throw new InvalidSep10ChallengeError("The transaction has operations that are not of type 'manageData'");
            }
            if (op.source !== serverAccountID &amp;&amp; op.name !== "client_domain") {
                throw new InvalidSep10ChallengeError("The transaction has operations that are unrecognized");
            }
            if (op.name === "web_auth_domain") {
                if (op.value === undefined) {
                    throw new InvalidSep10ChallengeError("'web_auth_domain' operation value should not be null");
                }
                if (op.value.compare(Buffer.from(webAuthDomain))) {
                    throw new InvalidSep10ChallengeError(`'web_auth_domain' operation value does not match ${webAuthDomain}`);
                }
            }
        }
        if (!verifyTxSignedBy(transaction, serverAccountID)) {
            throw new InvalidSep10ChallengeError(`Transaction not signed by server: '${serverAccountID}'`);
        }
        return { tx: transaction, clientAccountID, matchedHomeDomain, memo };
    }
    Utils.readChallengeTx = readChallengeTx;
    /**
     * verifyChallengeTxThreshold verifies that for a SEP 10 challenge transaction
     * all signatures on the transaction are accounted for and that the signatures
     * meet a threshold on an account. A transaction is verified if it is signed by
     * the server account, and all other signatures match a signer that has been
     * provided as an argument, and those signatures meet a threshold on the
     * account.
     *
     * Signers that are not prefixed as an address/account ID strkey (G...) will be
     * ignored.
     *
     * Errors will be raised if:
     *  - The transaction is invalid according to ReadChallengeTx.
     *  - No client signatures are found on the transaction.
     *  - One or more signatures in the transaction are not identifiable as the
     *    server account or one of the signers provided in the arguments.
     *  - The signatures are all valid but do not meet the threshold.
     *
     * @see [SEP0010: Stellar Web Authentication](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md).
     * @function
     * @memberof Utils
     * @param {string} challengeTx SEP0010 challenge transaction in base64.
     * @param {string} serverAccountID The server's stellar account (public key).
     * @param {string} networkPassphrase The network passphrase, e.g.: 'Test SDF Network ; September 2015'.
     * @param {number} threshold The required signatures threshold for verifying this transaction.
     * @param {ServerApi.AccountRecordSigners[]} signerSummary a map of all authorized signers to their weights. It's used to validate if the transaction signatures have met the given threshold.
     * @param {string|string[]} [homeDomains] The home domain(s) that should be included in the first Manage Data operation's string key. Required in verifyChallengeTxSigners() => readChallengeTx().
     * @param {string} webAuthDomain The home domain that is expected to be included as the value of the Manage Data operation with the 'web_auth_domain' key, if present. Used in verifyChallengeTxSigners() => readChallengeTx().
     * @returns {string[]} The list of signers public keys that have signed the transaction, excluding the server account ID, given that the threshold was met.
     * @example
     *
     * import { Networks, TransactionBuilder, Utils }  from 'stellar-sdk';
     *
     * const serverKP = Keypair.random();
     * const clientKP1 = Keypair.random();
     * const clientKP2 = Keypair.random();
     *
     * // Challenge, possibly built in the server side
     * const challenge = Utils.buildChallengeTx(
     *   serverKP,
     *   clientKP1.publicKey(),
     *   "SDF",
     *   300,
     *   Networks.TESTNET
     * );
     *
     * // clock.tick(200);  // Simulates a 200 ms delay when communicating from server to client
     *
     * // Transaction gathered from a challenge, possibly from the client side
     * const transaction = TransactionBuilder.fromXDR(challenge, Networks.TESTNET);
     * transaction.sign(clientKP1, clientKP2);
     * const signedChallenge = transaction
     *         .toEnvelope()
     *         .toXDR("base64")
     *         .toString();
     *
     * // Defining the threshold and signerSummary
     * const threshold = 3;
     * const signerSummary = [
     *    {
     *      key: this.clientKP1.publicKey(),
     *      weight: 1,
     *    },
     *    {
     *      key: this.clientKP2.publicKey(),
     *      weight: 2,
     *    },
     *  ];
     *
     * // The result below should be equal to [clientKP1.publicKey(), clientKP2.publicKey()]
     * Utils.verifyChallengeTxThreshold(signedChallenge, serverKP.publicKey(), Networks.TESTNET, threshold, signerSummary);
     */
    function verifyChallengeTxThreshold(challengeTx, serverAccountID, networkPassphrase, threshold, signerSummary, homeDomains, webAuthDomain) {
        var _a;
        const signers = signerSummary.map((signer) => signer.key);
        const signersFound = verifyChallengeTxSigners(challengeTx, serverAccountID, networkPassphrase, signers, homeDomains, webAuthDomain);
        let weight = 0;
        for (const signer of signersFound) {
            const sigWeight = ((_a = signerSummary.find((s) => s.key === signer)) === null || _a === void 0 ? void 0 : _a.weight) || 0;
            weight += sigWeight;
        }
        if (weight &lt; threshold) {
            throw new InvalidSep10ChallengeError(`signers with weight ${weight} do not meet threshold ${threshold}"`);
        }
        return signersFound;
    }
    Utils.verifyChallengeTxThreshold = verifyChallengeTxThreshold;
    /**
     * verifyChallengeTxSigners verifies that for a SEP 10 challenge transaction all
     * signatures on the transaction are accounted for. A transaction is verified
     * if it is signed by the server account, and all other signatures match a signer
     * that has been provided as an argument (as the accountIDs list). Additional signers
     * can be provided that do not have a signature, but all signatures must be matched
     * to a signer (accountIDs) for verification to succeed. If verification succeeds,
     * a list of signers that were found is returned, not including the server account ID.
     *
     * Signers that are not prefixed as an address/account ID strkey (G...) will be ignored.
     *
     * Errors will be raised if:
     *  - The transaction is invalid according to ReadChallengeTx.
     *  - No client signatures are found on the transaction.
     *  - One or more signatures in the transaction are not identifiable as the
     *    server account or one of the signers provided in the arguments.
     *
     * @see [SEP0010: Stellar Web Authentication](https://github.com/stellar/stellar-protocol/blob/master/ecosystem/sep-0010.md).
     * @function
     * @memberof Utils
     * @param {string} challengeTx SEP0010 challenge transaction in base64.
     * @param {string} serverAccountID The server's stellar account (public key).
     * @param {string} networkPassphrase The network passphrase, e.g.: 'Test SDF Network ; September 2015'.
     * @param {string[]} signers The signers public keys. This list should contain the public keys for all signers that have signed the transaction.
     * @param {string|string[]} [homeDomains] The home domain(s) that should be included in the first Manage Data operation's string key. Required in readChallengeTx().
     * @param {string} webAuthDomain The home domain that is expected to be included as the value of the Manage Data operation with the 'web_auth_domain' key, if present. Used in readChallengeTx().
     * @returns {string[]} The list of signers public keys that have signed the transaction, excluding the server account ID.
     * @example
     *
     * import { Networks, TransactionBuilder, Utils }  from 'stellar-sdk';
     *
     * const serverKP = Keypair.random();
     * const clientKP1 = Keypair.random();
     * const clientKP2 = Keypair.random();
     *
     * // Challenge, possibly built in the server side
     * const challenge = Utils.buildChallengeTx(
     *   serverKP,
     *   clientKP1.publicKey(),
     *   "SDF",
     *   300,
     *   Networks.TESTNET
     * );
     *
     * // clock.tick(200);  // Simulates a 200 ms delay when communicating from server to client
     *
     * // Transaction gathered from a challenge, possibly from the client side
     * const transaction = TransactionBuilder.fromXDR(challenge, Networks.TESTNET);
     * transaction.sign(clientKP1, clientKP2);
     * const signedChallenge = transaction
     *         .toEnvelope()
     *         .toXDR("base64")
     *         .toString();
     *
     * // The result below should be equal to [clientKP1.publicKey(), clientKP2.publicKey()]
     * Utils.verifyChallengeTxSigners(signedChallenge, serverKP.publicKey(), Networks.TESTNET, threshold, [clientKP1.publicKey(), clientKP2.publicKey()]);
     */
    function verifyChallengeTxSigners(challengeTx, serverAccountID, networkPassphrase, signers, homeDomains, webAuthDomain) {
        // Read the transaction which validates its structure.
        const { tx } = readChallengeTx(challengeTx, serverAccountID, networkPassphrase, homeDomains, webAuthDomain);
        // Ensure the server account ID is an address and not a seed.
        let serverKP;
        try {
            serverKP = Keypair.fromPublicKey(serverAccountID); // can throw 'Invalid Stellar public key'
        }
        catch (err) {
            throw new Error("Couldn't infer keypair from the provided 'serverAccountID': " +
                err.message);
        }
        // Deduplicate the client signers and ensure the server is not included
        // anywhere we check or output the list of signers.
        const clientSigners = new Set();
        for (const signer of signers) {
            // Ignore the server signer if it is in the signers list. It's
            // important when verifying signers of a challenge transaction that we
            // only verify and return client signers. If an account has the server
            // as a signer the server should not play a part in the authentication
            // of the client.
            if (signer === serverKP.publicKey()) {
                continue;
            }
            // Ignore non-G... account/address signers.
            if (signer.charAt(0) !== "G") {
                continue;
            }
            clientSigners.add(signer);
        }
        // Don't continue if none of the signers provided are in the final list.
        if (clientSigners.size === 0) {
            throw new InvalidSep10ChallengeError("No verifiable client signers provided, at least one G... address must be provided");
        }
        let clientSigningKey;
        for (const op of tx.operations) {
            if (op.type === "manageData" &amp;&amp; op.name === "client_domain") {
                if (clientSigningKey) {
                    throw new InvalidSep10ChallengeError("Found more than one client_domain operation");
                }
                clientSigningKey = op.source;
            }
        }
        // Verify all the transaction's signers (server and client) in one
        // hit. We do this in one hit here even though the server signature was
        // checked in the ReadChallengeTx to ensure that every signature and signer
        // are consumed only once on the transaction.
        const allSigners = [
            serverKP.publicKey(),
            ...Array.from(clientSigners),
        ];
        if (clientSigningKey) {
            allSigners.push(clientSigningKey);
        }
        const signersFound = gatherTxSigners(tx, allSigners);
        let serverSignatureFound = false;
        let clientSigningKeySignatureFound = false;
        for (const signer of signersFound) {
            if (signer === serverKP.publicKey()) {
                serverSignatureFound = true;
            }
            if (signer === clientSigningKey) {
                clientSigningKeySignatureFound = true;
            }
        }
        // Confirm we matched a signature to the server signer.
        if (!serverSignatureFound) {
            throw new InvalidSep10ChallengeError("Transaction not signed by server: '" + serverKP.publicKey() + "'");
        }
        // Confirm we matched a signature to the client domain's signer
        if (clientSigningKey &amp;&amp; !clientSigningKeySignatureFound) {
            throw new InvalidSep10ChallengeError("Transaction not signed by the source account of the 'client_domain' " +
                "ManageData operation");
        }
        // Confirm we matched at least one given signer with the transaction signatures
        if (signersFound.length === 1) {
            throw new InvalidSep10ChallengeError("None of the given signers match the transaction signatures");
        }
        // Confirm all signatures, including the server signature, were consumed by a signer:
        if (signersFound.length !== tx.signatures.length) {
            throw new InvalidSep10ChallengeError("Transaction has unrecognized signatures");
        }
        // Remove the server public key before returning
        signersFound.splice(signersFound.indexOf(serverKP.publicKey()), 1);
        if (clientSigningKey) {
            // Remove the client domain public key public key before returning
            signersFound.splice(signersFound.indexOf(clientSigningKey), 1);
        }
        return signersFound;
    }
    Utils.verifyChallengeTxSigners = verifyChallengeTxSigners;
    /**
     * Verifies if a transaction was signed by the given account id.
     *
     * @function
     * @memberof Utils
     * @param {Transaction} transaction
     * @param {string} accountID
     * @example
     * let keypair = Keypair.random();
     * const account = new StellarSdk.Account(keypair.publicKey(), "-1");
     *
     * const transaction = new TransactionBuilder(account, { fee: 100 })
     *    .setTimeout(30)
     *    .build();
     *
     * transaction.sign(keypair)
     * Utils.verifyTxSignedBy(transaction, keypair.publicKey())
     * @returns {boolean}.
     */
    function verifyTxSignedBy(transaction, accountID) {
        return gatherTxSigners(transaction, [accountID]).length !== 0;
    }
    Utils.verifyTxSignedBy = verifyTxSignedBy;
    /**
     *
     * gatherTxSigners checks if a transaction has been signed by one or more of
     * the given signers, returning a list of non-repeated signers that were found to have
     * signed the given transaction.
     *
     * @function
     * @memberof Utils
     * @param {Transaction} transaction the signed transaction.
     * @param {string[]} signers The signers public keys.
     * @example
     * let keypair1 = Keypair.random();
     * let keypair2 = Keypair.random();
     * const account = new StellarSdk.Account(keypair1.publicKey(), "-1");
     *
     * const transaction = new TransactionBuilder(account, { fee: 100 })
     *    .setTimeout(30)
     *    .build();
     *
     * transaction.sign(keypair1, keypair2)
     * Utils.gatherTxSigners(transaction, [keypair1.publicKey(), keypair2.publicKey()])
     * @returns {string[]} a list of signers that were found to have signed the transaction.
     */
    function gatherTxSigners(transaction, signers) {
        const hashedSignatureBase = transaction.hash();
        const txSignatures = clone(transaction.signatures);
        const signersFound = new Set();
        for (const signer of signers) {
            if (txSignatures.length === 0) {
                break;
            }
            let keypair;
            try {
                keypair = Keypair.fromPublicKey(signer); // This can throw a few different errors
            }
            catch (err) {
                throw new InvalidSep10ChallengeError("Signer is not a valid address: " + err.message);
            }
            for (let i = 0; i &lt; txSignatures.length; i++) {
                const decSig = txSignatures[i];
                if (!decSig.hint().equals(keypair.signatureHint())) {
                    continue;
                }
                if (keypair.verify(hashedSignatureBase, decSig.signature())) {
                    signersFound.add(signer);
                    txSignatures.splice(i, 1);
                    break;
                }
            }
        }
        return Array.from(signersFound);
    }
    Utils.gatherTxSigners = gatherTxSigners;
    /**
     * Verifies if the current date is within the transaction's timebonds
     *
     * @function
     * @memberof Utils
     * @param {Transaction} transaction the transaction whose timebonds will be validated.
     * @returns {boolean} returns true if the current time is within the transaction's [minTime, maxTime] range.
     */
    function validateTimebounds(transaction, gracePeriod = 0) {
        if (!transaction.timeBounds) {
            return false;
        }
        const now = Math.floor(Date.now() / 1000);
        const { minTime, maxTime } = transaction.timeBounds;
        return (now >= Number.parseInt(minTime, 10) - gracePeriod &amp;&amp;
            now &lt;= Number.parseInt(maxTime, 10) + gracePeriod);
    }
})(Utils || (Utils = {}));
//# sourceMappingURL=utils.js.map</code></pre>
        </article>
    </section>




</div>

<br class="clear">

<footer>
    Generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.5.5</a> on Tue Jan 18 2022 12:29:11 GMT-0800 (Pacific Standard Time) using the Minami theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/linenumber.js"></script>
</body>
</html>
